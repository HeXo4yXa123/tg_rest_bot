<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>MestiGo — Combined</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Rubik:wght@400&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;800;900&family=Rubik:wght@400&display=swap" rel="stylesheet">
<style>
/* === BASE (merged from both) === */
*{box-sizing:border-box;margin:0;padding:0}
:root{--design-w:393;--scale:1;--inv-scale:1;--vh:1vh;--tg-top:var(--tg-safe-area-inset-top,0px);--tg-bottom:var(--tg-safe-area-inset-bottom,0px);--safe-top:max(env(safe-area-inset-top,0px),var(--tg-top));--safe-bottom:max(env(safe-area-inset-bottom,0px),var(--tg-bottom));}
html,body{height:100%}
body{background:#0b0b0b;font-family:'Inter',sans-serif;color:#fff;-webkit-font-smoothing:antialiased;text-rendering:geometricPrecision;overflow:hidden;}
/* Telegram/Desktop safe viewport wrapper */
.viewport{width:100%;height:calc(var(--vh)*100);display:flex;justify-content:center;background:#0b0b0b;overflow:hidden}
.scale-wrap{width:100%;max-width:calc(var(--design-w)*1px);height:100%;margin:0 auto;position:relative}
.app-scroll{width:100%;height:100%;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch}
.app-stage{position:relative;width:var(--stage-w, calc(var(--design-w)*1px));height:var(--stage-h, calc(var(--vh)*100));margin:0 auto}
.app{width:calc(var(--design-w)*1px);max-width:none;margin:0;min-height:calc(var(--vh)*100);position:absolute;left:0;top:0;padding-bottom:64px;transform:scale(var(--scale));transform-origin:top left}
/* Screens */
.screen{display:none}
.screen.active{display:block}
/* ===== TABBAR (merged) ===== */
.tabbar-wrapper{width:calc(var(--design-w)*1px);position:fixed;left:50%;right:auto;bottom:var(--safe-bottom);z-index:100;transform:translateX(-50%) scale(var(--scale));transform-origin:bottom center;padding-bottom:0;}
.tabbar{height:64px;background:#0e110f;border-top-left-radius:24px;border-top-right-radius:24px;border-top:1px solid rgba(255,255,255,.08);display:flex;justify-content:space-around;align-items:center;transform:translateY(0);transition:transform 0.3s ease}
.tab{display:flex;flex-direction:column;align-items:center;gap:4px;background:none;border:none;color:#8c8c8b;font-size:10.5px;font-weight:400}
.tab.active{color:#21EA7C}
.tabicon{width:24px;height:24px;object-fit:contain;display:block}
/* ===== iOS FIXES (Telegram iPhone/iPad) =====
   Цель: не оставлять белую полоску снизу и не "улетать" таббару.
   НИЧЕГО не ломаем: только доп. правила для iOS.
*/
.ios .tabbar-wrapper{
  /* на iPhone safe-area уже учтён в viewport, поэтому не поднимаем панель вверх */
  bottom: 0 !important;
  background: #0e110f; /* чтобы низ не выглядел пустым/белым */
}
.ios .tabbar{
  /* на iOS часто глючит hide-on-scroll (elastic scroll) — держим видимой */
  transform: translateY(0) !important;
}
/* чтобы контент не прятался под таббаром на iPhone */
.ios .app{
  padding-bottom: calc(64px + (var(--safe-bottom) * var(--inv-scale)));
}
/* ===== FAVORITES (EMPTY + LIST) ===== */
.fav-title{margin:35px 16px 0;font-size:30px;font-weight:800}
.searchRow{margin-top:30px;padding:0 15px;display:flex;gap:7px}
.search-input{flex:1;height:38px;background:#1B1B1B;border-radius:14px;display:flex;align-items:center;padding:0 14px;box-shadow:0 0 5px rgba(59,180,74,.25)}
.search-text{font-size:16px;color:#C7CFCB}
.find-button{width:98px;height:38px;border-radius:14px;background:linear-gradient(135deg,#40CC5E,#36B854);border:none;color:#fff;font-size:16px}
.allRestaurantsList{margin:30px 0 120px;padding:0 16px;display:flex;flex-direction:column;gap:20px}
.allRestaurantPreview{height:180px;background:#2E2E2C;border-radius:25px;position:relative;overflow:hidden}
.allRestaurantFavorite{position:absolute;top:10px;right:10px;width:32px;height:32px;border-radius:50%;background:rgba(33,234,124,.85);box-shadow:0 0 5px rgba(59,180,74,.5);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center}
.allRestaurantInfo{margin-top:11px}
.allRestaurantNameRow{display:flex;justify-content:space-between;align-items:center;padding-left:21px;padding-right:26px;margin-left:-10px}
.allRestaurantName{font-size:17px;font-weight:700}
.allRestaurantRating{font-family:'Rubik';font-size:14px;color:#21EA7C;margin-right:-10px}
.allRestaurantDelivery{margin-top:7px;font-family:'Rubik';font-size:14px;color:#21EA7C;padding-left:21px;margin-left:-10px;display:flex;align-items:center;gap:8px}
.allRestaurantDelivery::before{content:'';display:inline-block;width:16px;height:16px;background:url('icons/delivery-icon.png');background-size:contain} /* Assume icons/delivery-icon.png for delivery icon */
/* Empty favorites */
.empty-wrap{margin-top:50px;text-align:center;padding:0 70px}
.image-placeholder{width:240px;height:167px;margin:0 auto 16px;background:url(icons/избранное.png);border-radius:16px} /* Updated to match cart style */
.empty-title{font-size:16px;font-weight:600}
.empty-subtitle{margin-top:4px;font-size:14px;color:rgba(255,255,255,.7)}
.go-btn{margin:24px auto 0;display:block;width:267px;height:36px;border-radius:12px;background:linear-gradient(135deg,#40CC5E,#36B854);border:none;color:#fff;font-size:14px}
/* Favorites screen tweaks (чтобы не уезжало вниз) */
.screen[data-screen="favorites"] .fav-title{margin-top:24px}
.screen[data-screen="favorites"] .searchRow{margin-top:18px}
.screen[data-screen="favorites"] .empty-wrap{margin-top:24px;padding:0 16px;text-align:center}
.screen[data-screen="favorites"] .image-placeholder{
  width:220px;height:220px;margin:0 auto 24px auto;border-radius:30px;
  background:url(icons/избранное.png) center/cover no-repeat;
}
.screen[data-screen="favorites"] .go-btn{width:100%;max-width:361px;height:44px;border-radius:16px}
/* ===== CART OVERLAY ===== */
.cart-open #scrollRoot{overflow:hidden}
.cart-open .tabbar-wrapper{display:none}

.cart-overlay{
  position:fixed;
  inset:0;
  background:#0b0b0b; /* opaque: за корзиной ничего не видно */
  display:none;
  z-index:9999;
  align-items:stretch;
  justify-content:center;
}
.cart-overlay.active{display:flex}

/* Fullscreen sheet (scaled like the app), centered */
.cart-sheet{
  position:relative;
  width:calc(var(--design-w)*1px);
  max-width:100%;
  height:calc(var(--vh)*100);
  background:#0b0b0b;
  padding-bottom:var(--safe-bottom);
  transform:scale(var(--scale));
  transform-origin:top center;
}

/* cart content */
.cart-close{position:absolute;top:55px;left:30px;color:#21EA7C;font-size:22px;cursor:pointer}
.cart-empty-img{position:absolute;top:249px;left:50%;transform:translateX(-50%);width:195px;height:206px;background:url(icons/корзина.png) center/cover no-repeat;border-radius:16px}
.cart-empty-title{position:absolute;top:495px;left:0;right:0;padding:0 70px;text-align:center;font-size:16px;font-weight:600}
.cart-empty-sub{position:absolute;top:531px;left:0;right:0;padding:0 32px;text-align:center;font-size:14px;color:rgba(255,255,255,.7)}
.cart-btn{position:absolute;bottom:calc(13px + (var(--safe-bottom) * var(--inv-scale)));left:50%;transform:translateX(-50%);width:calc((var(--design-w)*1px) - 32px);max-width:calc(100% - 32px);height:52px;background:#21EA7C;border-radius:16px;border:none;color:#fff;font-size:16px;font-weight:600;display:flex;align-items:center;justify-content:center;text-align:center;padding:0;}
/* ===== HEART STATES (updated) ===== */
.specialFavorite,
.allRestaurantFavorite {
  background: rgba(33,234,124,.55);
}

/* SVG по умолчанию */
.heart-svg {
  width: 20px;
  height: 20px;
  fill: transparent;
  stroke: #0E3F23;      /* тёмный зелёный */
  stroke-width: 2;
  transition: fill .25s ease, transform .2s ease;
}

/* активное состояние (БЕЗ анимации) */
.specialFavorite.active .heart-svg,
.allRestaurantFavorite.active .heart-svg {
  fill: #0E3F23;
  stroke: #0E3F23;
}

/* анимация ТОЛЬКО при клике */
.specialFavorite.animate .heart-svg,
.allRestaurantFavorite.animate .heart-svg {
  animation: heart-pop .25s ease;
}

@keyframes heart-pop {
  0%   { transform: scale(1); }
  50%  { transform: scale(1.18); }
  100% { transform: scale(1); }
}

/* Additional styles from index.html */
.header{background-color:#252525;border-radius:0 0 20px 20px;box-shadow:0 0 20px rgba(0,0,0,0.2);position:relative;width:100%;max-width:393px;left:0;right:0}
.header-content{padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
.address{display:flex;flex-direction:column;gap:2px}
.city{font-size:16px;font-weight:500;line-height:22px;color:#ffffff;display:inline-flex;align-items:center}
.city-text{color:#ffffff}
.city-arrow{margin-left:6px;font-size:15px;color:#ffffff;opacity:0.6}
.prompt{font-size:13px;font-weight:500;line-height:15px;color:rgba(255,255,255,0.7)}
.avatar{width:41px;height:41px;border-radius:50%;background:linear-gradient(to bottom right,#a855f7,#d946ef);display:flex;justify-content:center;align-items:center;color:#ffffff;font-weight:500;font-size:16px;flex-shrink:0}
.searchRow{margin-top:20px;margin-bottom:25px;padding:0 15px;width:100%;max-width:393px}
.search-input{flex:1;height:36px;background-color:#1B1B1B;border-radius:14px;box-shadow:0 0 5px rgba(59,180,74,0.25);display:flex;align-items:center;padding:0 15px}
.search-icon{width:13px;height:13px;margin-right:8px;flex-shrink:0;display:block;transform:translateY(-1px)}
.search-text{font-weight:500;font-size:16px;line-height:22px;color:#C7CFCB}
.find-button{width:98px;height:36px;background:linear-gradient(135deg,#40CC5E,#36B854);border-radius:14px;border:none;box-shadow:0 0 5px rgba(59,180,74,0.25);font-weight:500;font-size:16px;line-height:22px;color:#FFFFFF;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.promoBannerWrap{position:relative;width:363px;height:120px;border-radius:15px;box-shadow:0 0 5px rgba(59,180,74,0.25);margin-bottom:40px;margin-left:15px;margin-right:15px}
.promoBanner{position:relative;width:363px;height:120px;border-radius:15px;overflow:hidden;cursor:pointer;opacity:0.9;box-shadow:inset 0 0 5px rgba(59,180,74,0.25);background-image:url("icons/Rectangle\ 10.png");background-size:393px;background-position:center;background-repeat:no-repeat}
.promoBanner__food{position:absolute;left:0;top:0;width:154px;height:120px;object-fit:cover;pointer-events:none}
.promoBanner__title{position:absolute;left:154px;top:25px;width:164px;height:50px;font-family:'Montserrat',sans-serif;font-weight:800;font-size:15px;line-height:17px;color:#FFFFFF;text-align:left}
.promoBanner__titleLine{display:block;white-space:nowrap}
.card--img1{width:170px;top:12px;z-index:2;position:absolute;left:13px;cursor:pointer}
.card--img2{width:100px;top:-15px;z-index:2;position:absolute;right:60px;cursor:pointer}
.card--img3{width:90px;top:88px;z-index:2;position:absolute;right:60px;cursor:pointer}
.promoBanner__badge{position:absolute;width:100px;height:23px;border-radius:11px;top:91px}
.promoBanner__badge--yellow{left:148px;background:#FDC505}
.promoBanner__badge--green{left:252px;background:#005218}
.promoBanner__badgeText{position:absolute;font-family:'Inter',sans-serif;font-weight:900;font-size:7px;line-height:17px;color:#FFFFFF;white-space:nowrap;top:3px}
.promoBanner__badgeText--yellow{left:50%;transform:translateX(calc(-50% - 1px))}
.promoBanner__badgeText--green{left:8px}
.cardsBlock{position:relative;width:100%;max-width:393px;height:173px;margin-bottom:30px}
.card{position:absolute;background:#1D1D1D;border-radius:15px;box-shadow:0 0 5px rgba(59,180,74,0.25),inset 0 4px 4px rgba(0,0,0,0.25);cursor:pointer}
.card--restaurants{left:25px;top:0;width:159px;height:159px;background-position:center;background-repeat:no-repeat;background-size:contain}
.card--shops{left:209px;top:0;width:159px;height:64px;background-position:center;background-repeat:no-repeat;background-size:contain}
.card--promos{left:209px;top:95px;width:159px;height:64px;background-position:center;background-repeat:no-repeat;background-size:contain}
.cardLabel{position:absolute;width:159px;font-family:'Roboto',sans-serif;font-weight:500;font-size:12px;line-height:14px;color:rgba(255,255,255,0.8);text-align:center}
.cardLabel--restaurants{left:25px;top:163px}
.cardLabel--shops{left:209px;top:70px}
.cardLabel--promos{left:209px;top:163px}
.storesSection{margin-top:0}
.storesHeader{display:flex;justify-content:space-between;align-items:center;padding:0 20px 0 16px;margin-bottom:20px}
.storesTitle{font-family:'Inter';font-weight:800;font-size:20px;line-height:24px;color:rgba(255,255,255,0.85)}
.storesButton{width:57px;height:25px;border-radius:20px;background:#2E2E2C;box-shadow:0 0 5px rgba(59,180,74,0.25);display:flex;align-items:center;gap:8px;padding:0 5px 0 10px;border:none;cursor:pointer}
.storesButtonText{font-family:'Rubik';font-weight:400;font-size:13px;line-height:15px;color:rgba(33,234,124,0.85)}
.storesButtonArrow{width:5px;height:7px}
.storesCards{display:flex;gap:15px;padding:0 16px;margin-bottom:3px}
.storeCard{width:112px;height:59px;background:#1D1D1D;border-radius:15px;box-shadow:0 0 5px rgba(59,180,74,0.25)}
.storesTimings{display:flex;gap:56px;padding:0 16px}
.storeTiming{font-family:'Rubik';font-weight:400;font-size:13px;line-height:15px;letter-spacing:0.1px;color:#21EA7C;padding-left:5px;text-align:left;white-space:nowrap;display:block}
.restaurantsSection{margin-top:30px}
.restaurantsHeader{display:flex;justify-content:space-between;align-items:center;padding:0 20px 0 16px;margin-bottom:20px}
.restaurantsTitle{font-family:'Inter';font-weight:800;font-size:20px;line-height:24px;color:rgba(255,255,255,0.85)}
.restaurantsButton{width:57px;height:25px;border-radius:20px;background:#2E2E2C;box-shadow:0 0 5px rgba(59,180,74,0.25);display:flex;align-items:center;gap:8px;padding:0 5px 0 10px;border:none;cursor:pointer}
.restaurantsButtonText{font-family:'Rubik';font-weight:400;font-size:13px;line-height:15px;color:rgba(33,234,124,0.85)}
.restaurantsButtonArrow{width:5px;height:7px}
.restaurantsCards{display:flex;gap:15px;padding:0 16px;margin-bottom:3px}
.restaurantCard{width:112px;height:59px;background:#1D1D1D;border-radius:15px;box-shadow:0 0 5px rgba(59,180,74,0.25)}
.restaurantsTimings{display:flex;gap:56px;padding:0 16px}
.restaurantTiming{font-family:'Rubik';font-weight:400;font-size:13px;line-height:15px;letter-spacing:0.1px;color:#21EA7C;padding-left:5px;text-align:left;white-space:nowrap;display:block}
.mg-categories{margin-left:14px;margin-right:14px;margin-top:30px}
.mg-categories__title{font-family:Inter;font-weight:800;font-size:20px;line-height:24px;color:rgba(255,255,255,0.85);margin-bottom:8px;margin-left:2px}
.mg-categories__list{display:flex;flex-direction:row;flex-wrap:nowrap;gap:24px;overflow-x:auto;overflow-y:visible;padding-left:0;padding-right:14px;padding-top:10px;scroll-behavior:smooth;-webkit-overflow-scrolling:touch;-ms-overflow-style:none;scrollbar-width:none;cursor:pointer}
.mg-categories__list::-webkit-scrollbar{display:none}
.mg-category-item{display:flex;flex-direction:column;align-items:center;gap:6px;flex-shrink:0}
.mg-category-item__icon{width:65px;height:65px;border-radius:50%;background-color:transparent;box-shadow:0 0 5px rgba(59,180,74,0.25)}
.mg-category-item__text{font-family:Roboto;font-weight:400;font-size:11px;line-height:13px;color:rgba(255,255,255,0.8);text-align:center}
.mg-categories__controls{margin-top:18px;display:flex;flex-direction:row;flex-wrap:nowrap;gap:5px;overflow-x:auto;overflow-y:visible;padding-left:2px;padding-right:2px;padding-top:10px;padding-bottom:12px;scroll-behavior:smooth;-webkit-overflow-scrolling:touch;-ms-overflow-style:none;scrollbar-width:none}
.mg-categories__controls::-webkit-scrollbar{display:none}
.mg-control-button{height:37px;border-radius:25px;background:#1D1D1D;box-shadow:0 0 5px rgba(59,180,74,0.25);display:flex;align-items:center;justify-content:center;flex-shrink:0;border:none;cursor:pointer}
.mg-control-button--settings{width:38px}
.mg-control-button--rating{width:100px} /* Slightly smaller */
.mg-control-button--promos{width:85px} /* Slightly smaller */
.mg-control-button--time{width:105px} /* Slightly smaller */
.mg-control-button__text{font-family:'Rubik';font-weight:400;font-size:13px;line-height:15px;color:rgba(255,255,255,0.8)}
.mg-control-icon{width:18px;height:18px}
.specialSection{margin-top:30px}
.specialHeader{display:flex;justify-content:space-between;align-items:center;padding:0 20px 0 16px;margin-bottom:20px}
.specialTitle{font-family:'Inter';font-weight:800;font-size:20px;line-height:24px;color:rgba(255,255,255,0.85)}
.specialButton{width:57px;height:25px;border-radius:20px;background:#1D1D1D;box-shadow:0 0 5px rgba(59,180,74,0.25);display:flex;align-items:center;gap:8px;padding:0 5px 0 10px;border:none;cursor:pointer}
.specialButtonText{font-family:'Rubik';font-weight:400;font-size:13px;line-height:15px;color:rgba(33,234,124,0.85)}
.specialButtonArrow{width:5px;height:7px}
.specialCards{display:flex;flex-wrap:nowrap;gap:15px;overflow-x:auto;overflow-y:visible;padding:0 16px 30px 16px;scroll-behavior:smooth;-webkit-overflow-scrolling:touch;-ms-overflow-style:none;scrollbar-width:none;cursor:pointer}
.specialCards::-webkit-scrollbar{display:none}
.specialCard{flex-shrink:0;width:286px;display:flex;flex-direction:column;cursor:pointer}
.specialPreview{position:relative;width:286px;height:142px;background:#2E2E2C;border-radius:25px;overflow:hidden}
.specialFavorite{position:absolute;top:10px;right:10px;width:32px;height:32px;border-radius:50%;background:rgba(33,234,124,.85);box-shadow:0 0 5px rgba(59,180,74,0.5);border:none;cursor:pointer;z-index:2;display:flex;align-items:center;justify-content:center}
.specialInfo{margin-top:10px}
.specialNameRow{display:flex;justify-content:space-between;align-items:center}
.specialName{font-family:'Inter';font-weight:700;font-size:15px;line-height:1.2;color:#FFFFFF}
.specialRating{font-family:'Rubik';font-weight:400;font-size:13px;line-height:1.2;color:#21EA7C;transform:translateX(-6px)}
.specialDelivery{font-family:'Rubik';font-weight:400;font-size:13px;line-height:1.2;color:#21EA7C;margin-top:4px;display:flex;align-items:center;gap:8px}
.specialDelivery::before{content:'';display:inline-block;width:16px;height:16px;background:url('icons/delivery-icon.png');background-size:contain} /* Assume icons/delivery-icon.png */
.specialSection + .specialSection{margin-top:30px !important}
.specialCards{padding-bottom:0 !important}
.allRestaurantsList{padding:0 16px;display:flex;flex-direction:column;gap:20px;margin-bottom:30px;margin-top:30px}
.allRestaurantCard{width:100%;display:flex;flex-direction:column;cursor:pointer}
.allRestaurantPreview{position:relative;width:100%;height:180px;background:#2E2E2C;border-radius:25px;overflow:hidden}
.allRestaurantFavorite{position:absolute;top:10px;right:10px;width:32px;height:32px;border-radius:50%;background:rgba(33,234,124,.85);box-shadow:0 0 5px rgba(59,180,74,0.5);border:none;cursor:pointer;z-index:2;display:flex;align-items:center;justify-content:center}
.allRestaurantInfo{margin-top:10px}
.allRestaurantNameRow{display:flex;justify-content:space-between;align-items:center}
.allRestaurantName{font-family:'Inter';font-weight:700;font-size:17px;color:#FFFFFF}
.allRestaurantRating{font-family:'Rubik';font-weight:400;font-size:14px;color:#21EA7C;transform:translateX(-6px)}
.allRestaurantDelivery{font-family:'Rubik';font-weight:400;font-size:14px;color:#21EA7C;margin-top:4px;display:flex;align-items:center;gap:8px}
.allRestaurantDelivery::before{content:'';display:inline-block;width:16px;height:16px;background:url('icons/delivery-icon.png');background-size:contain} /* Assume icons/delivery-icon.png */
.screen-empty{min-height:calc(var(--vh)*100);padding-top:120px}
.empty-page{color:rgba(255,255,255,0.6);text-align:center;font-size:16px}
/* Unified restaurant card class for favorites functionality */
.restaurant-card { /* Added for unification */ }
/* ===== BACK ARROW ===== */
.back-btn{margin-top:60px;margin-left:16px;width:24px;height:24px;cursor:pointer}
.back-btn svg{width:24px;height:24px;stroke:#21EA7C;display:block}
/* ===== PROFILE (NEW LAYOUT) ===== */
.screen[data-screen="profile"]{
  position: relative;
  padding-top: 0;
}

/* header */
.screen[data-screen="profile"] .header{
  position: relative;
  width: 393px;
  height: 87px;
  background: #252525;
  border-bottom-left-radius: 20px;
  border-bottom-right-radius: 20px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
  margin: 0 auto;
}
.screen[data-screen="profile"] .avatar{
  position: absolute;
  left: 20px;
  top: 21px;
  width: 41px;
  height: 41px;
  border-radius: 50%;
  background: linear-gradient(to bottom right, #a855f7, #d946ef);
  color: #FFFFFF;
  font-size: 16px;
  font-weight: 500;
  line-height: 41px;
  text-align: center;
}
.screen[data-screen="profile"] .nickname{
  position: absolute;
  left: 80px;
  top: 24px;
  font-size: 17px;
  font-weight: 700;
  color: #FFFFFF;
  line-height: 15px;
}
.screen[data-screen="profile"] .id{
  position: absolute;
  left: 80px;
  top: 48px;
  font-size: 12px;
  font-weight: 400;
  color: rgba(255,255,255,0.5);
  line-height: 15px;
}

/* menus */
.screen[data-screen="profile"] .menu,
.screen[data-screen="profile"] .new-menu,
.screen[data-screen="profile"] .service-menu{
  width: 361px;
  margin: 30px 16px 0 16px;
  background: #252525;
  border-radius: 16px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
  overflow: hidden;
}
.screen[data-screen="profile"] .new-menu{ margin-top: 14px; }
.screen[data-screen="profile"] .service-menu{ margin-top: 14px; }

.screen[data-screen="profile"] .item{
  position: relative;
  height: 44px;
  line-height: 44px;
  padding-left: 62px;
  font-size: 16px;
  font-weight: 400;
  color: rgba(255, 255, 255, 0.85);
  cursor: pointer;
}
.screen[data-screen="profile"] .item:not(:last-child)::after{
  content: '';
  position: absolute;
  left: 62px;
  bottom: 0;
  width: 299px;
  height: 0.3px;
  background: rgba(255, 255, 255, 0.08);
}

.screen[data-screen="profile"] .new-item{
  position: relative;
  height: 44px;
  display: flex;
  align-items: center;
  padding-left: 62px;
  font-size: 16px;
  font-weight: 400;
  color: rgba(255, 255, 255, 0.85);
  cursor: pointer;
}
.screen[data-screen="profile"] .new-item:not(:last-child)::after{
  content: '';
  position: absolute;
  left: 62px;
  bottom: 0;
  width: 299px;
  height: 0.3px;
  background: rgba(255, 255, 255, 0.08);
}

.screen[data-screen="profile"] .service-item{
  position: relative;
  height: 44px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-left: 62px;
  padding-right: 41px;
  cursor: pointer;
}
.screen[data-screen="profile"] .service-item__text{
  font-size: 16px;
  font-weight: 400;
  color: rgba(255, 255, 255, 0.85);
}
.screen[data-screen="profile"] .service-item__subtext{
  font-size: 16px;
  font-weight: 400;
  color: rgba(255, 255, 255, 0.35);
}
.screen[data-screen="profile"] .service-item:not(:last-child)::after{
  content: '';
  position: absolute;
  left: 62px;
  bottom: 0;
  width: 299px;
  height: 0.3px;
  background: rgba(255, 255, 255, 0.08);
}

/* add home block */
.screen[data-screen="profile"] .add-home-block{
  width: 361px;
  height: 112px;
  margin: 24px 16px 0 16px;
  background: linear-gradient(to bottom, #1B1B1B 0%, #232323 100%);
  border-radius: 20px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
  padding: 11px 11px 14px 11px;
}
.screen[data-screen="profile"] .add-home-inner-block{
  width: 100%;
  height: 44px;
  background: #252525;
  border-radius: 11px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  font-weight: 400;
  color: rgba(255, 255, 255, 0.85);
}
.screen[data-screen="profile"] .add-home-description{
  margin-top: 10px;
  padding: 0 38px;
  font-size: 12px;
  line-height: 15px;
  font-weight: 400;
  color: rgba(255, 255, 255, 0.6);
  text-align: center;
}


/* ===== SAFE AREA (iOS) ===== */
:root{--safe-bottom:0px}
@supports (padding: env(safe-area-inset-bottom)){
  :root{--safe-bottom:env(safe-area-inset-bottom)}
}
.app{padding-bottom:calc(64px + (var(--safe-bottom) * var(--inv-scale)))}
.tabbar-wrapper{padding-bottom:0}
.cart-sheet{max-height:calc(100vh - var(--safe-bottom))}


/* =========================
   RESPONSIVE IMAGE FIT FIX (Telegram/WebView safe)
   - forces preview/background images to fully fill their containers
========================= */
html{-webkit-text-size-adjust:100%;}
img{display:block;max-width:100%;height:auto;-webkit-user-drag:none;user-select:none}
.promoBanner,
.storeCard,
.restaurantCard,
.specialPreview,
.allRestaurantPreview,
.image-placeholder,
.cart-empty-img{
  background-size:cover !important;
  background-position:center !important;
  background-repeat:no-repeat !important;
}
.promoBanner{background-size:cover !important;background-position:center !important}
.promoBanner__food{object-fit:cover}
.cardsBlock img{display:block}

</style>
</head>
<body>
<div class="viewport">
  <div class="scale-wrap">
    <div class="app-scroll" id="scrollRoot">
      <div class="app-stage" id="appStage">
        <div class="app" id="app">
  <!-- HOME (full content from index.html integrated) -->
  <div class="screen active" data-screen="home">
    <!-- Header -->
    <div class="header">
      <div class="header-content">
        <div class="address">
          <div class="city">
            <span class="city-text">г. Местия</span>
            <span class="city-arrow">></span>
          </div>
          <span class="prompt">Укажите адрес доставки</span>
        </div>
        <div class="avatar">AS</div>
      </div>
    </div>
    <!-- Search row -->
    <div class="searchRow">
      <div class="search-input">
        <svg class="search-icon" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="6" cy="6" r="5.3" stroke="#40CC5E" stroke-width="1.4"/>
          <path d="M9.8 9.8L13 13" stroke="#40CC5E" stroke-width="1.4" stroke-linecap="round"/>
        </svg>
        <span class="search-text">Искать в mestigo</span>
      </div>
      <button class="find-button">Найти</button>
    </div>
    <!-- Promo banner -->
    <div class="promoBannerWrap">
      <div class="promoBanner">
        <div class="promoBanner__title">
          <span class="promoBanner__titleLine">СКИДКА 15%</span>
          <span class="promoBanner__titleLine">НА ПЕРВЫЙ ЗАКАЗ</span>
          <span class="promoBanner__titleLine">ОТ 50 GEL</span>
        </div>
        <div class="promoBanner__badge promoBanner__badge--yellow">
          <span class="promoBanner__badgeText promoBanner__badgeText--yellow">сумируется со скидками</span>
        </div>
        <div class="promoBanner__badge promoBanner__badge--green">
          <span class="promoBanner__badgeText promoBanner__badgeText--green">+ бесплатная доставка</span>
        </div>
      </div>
    </div>
    <!-- Cards block -->
    <div class="cardsBlock">
      <div class="card card--restaurants" onclick="goTab('restaurants')"></div>
      <img src="icons/Group 1321314497.png" width="100px" class="card--img1" onclick="goTab('restaurants')">
      <div class="card card--shops" onclick="goTab('shops')"></div>
      <img src="icons/раздел_магазины-removebg-preview-removebg-preview 4.png" width="100px" class="card--img2" onclick="goTab('shops')">
      <div class="card card--promos" onclick="goTab('promos')"></div>
      <img src="icons/раздел_акции-removebg-preview 4.png" width="100px" class="card--img3" onclick="goTab('promos')">
      <div class="cardLabel cardLabel--restaurants">Рестораны</div>
      <div class="cardLabel cardLabel--shops">Магазины</div>
      <div class="cardLabel cardLabel--promos">Акции</div>
    </div>
    <!-- Stores section -->
    <div class="storesSection">
      <div class="storesHeader">
        <span class="storesTitle">Магазины</span>
        <button class="storesButton">
          <span class="storesButtonText">Все</span>
          <img class="storesButtonArrow" src="icons/right-arrow 2.png" width="5" height="7">
        </button>
      </div>
      <div class="storesCards">
        <div class="storeCard" style="background-image: url(icons/Rectangle\ 16.png);"></div>
        <div class="storeCard" style="background-image: url(icons/Rectangle\ 17.png);"> </div>
        <div class="storeCard" style="background-image: url(icons/Rectangle\ 20.png);"> </div>
      </div>
      <div class="storesTimings">
        <span class="storeTiming">15–25 мин</span>
        <span class="storeTiming">20–30 мин</span>
        <span class="storeTiming">20–30 мин</span>
      </div>
    </div>
    <section class="mg-categories">
      <div class="mg-categories__title">Категории блюд</div>
      <div class="mg-categories__list" onclick="goTab('categories')">
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Фастфуд</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Местная</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Грузинская</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Европа</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Восток</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Италия</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Япония</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Бургеры</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Пицца</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Шаурма</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Сэндвичи</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Выпечка</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Блины</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Десерты</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Шашлык</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Паста</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Супы</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Паста</div>
        </div>
      </div>
      <div class="mg-categories__controls">
        <button class="mg-control-button mg-control-button--settings">
        </button>
        <button class="mg-control-button mg-control-button--rating">
          <span class="mg-control-button__text">Рейтинг</span>
        </button>
        <button class="mg-control-button mg-control-button--promos">
          <span class="mg-control-button__text">Акции</span>
        </button>
        <button class="mg-control-button mg-control-button--time">
          <span class="mg-control-button__text">До 30 мин</span>
        </button>
      </div>
    </section>
    <!-- Restaurants section -->
    <div class="restaurantsSection">
      <div class="restaurantsHeader">
        <span class="restaurantsTitle">Популярные рестораны</span>
        <button class="restaurantsButton">
          <span class="restaurantsButtonText">Все</span>
          <img class="storesButtonArrow" src="icons/right-arrow 2.png" width="5" height="7">
        </button>
      </div>
      <div class="restaurantsCards">
        <div class="restaurantCard" style="background-image: url(icons/Rectangle\ 36.png);"></div>
        <div class="restaurantCard" style="background-image: url(icons/Rectangle\ 18.png);" ></div>
        <div class="restaurantCard" style="background-image: url(icons/Rectangle\ 25.png);" ></div>
      </div>
      <div class="restaurantsTimings">
        <span class="restaurantTiming">15–25 мин</span>
        <span class="restaurantTiming">20–30 мин</span>
        <span class="restaurantTiming">20–30 мин</span>
      </div>
    </div>
    <!-- Special section: Специально для вас -->
    <div class="specialSection">
      <div class="specialHeader">
        <span class="specialTitle">Специально для вас</span>
        <button class="specialButton">
          <span class="specialButtonText">Все</span>
          <img class="storesButtonArrow" src="icons/right-arrow 2.png" width="5" height="7">
        </button>
      </div>
      <div class="specialCards">
        <div class="specialCard restaurant-card" data-screen="restaurant-sunset" data-id="sunset" data-name="SUNSET RESTAURANT" data-rating="4.7" data-delivery="25–30 мин" data-img="icons/sunset.png">
          <div class="specialPreview" style="background-image:url(icons/sunset.png)">
            <button class="specialFavorite">
              <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              </svg>
            </button>
          </div>
          <div class="specialInfo">
            <div class="specialNameRow">
              <span class="specialName">SUNSET RESTAURANT</span>
              <span class="specialRating">4.7</span>
            </div>
            <div class="specialDelivery">25–30 мин</div>
          </div>
        </div>
        <div class="specialCard restaurant-card" data-screen="restaurant-bbq" data-id="bbq" data-name="BBQ GARDEN" data-rating="4.5" data-delivery="25–30 мин" data-img="icons/bbq.png">
          <div class="specialPreview" style="background-image:url(icons/bbq.png)">
            <button class="specialFavorite">
              <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              </svg>
            </button>
          </div>
          <div class="specialInfo">
            <div class="specialNameRow">
              <span class="specialName">BBQ GARDEN</span>
              <span class="specialRating">4.5</span>
            </div>
            <div class="specialDelivery">25–30 мин</div>
          </div>
        </div>
        <div class="specialCard restaurant-card" data-screen="restaurant-kubdari" data-id="kubdari" data-name="ДОМ КУБДАРИ" data-rating="4.9" data-delivery="25–30 мин" data-img="icons/кудбари.png">
          <div class="specialPreview" style="background-image:url(icons/кудбари.png)">
            <button class="specialFavorite">
              <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              </svg>
            </button>
          </div>
          <div class="specialInfo">
            <div class="specialNameRow">
              <span class="specialName">ДОМ КУБДАРИ</span>
              <span class="specialRating">4.9</span>
            </div>
            <div class="specialDelivery">25–30 мин</div>
          </div>
        </div>
        <div class="specialCard restaurant-card" data-screen="restaurant-laila" data-id="laila" data-name="CAFE LAILA" data-rating="4.8" data-delivery="25–30 мин" data-img="icons/laila.png">
          <div class="specialPreview" style="background-image:url(icons/laila.png)">
            <button class="specialFavorite">
              <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              </svg>
            </button>
          </div>
          <div class="specialInfo">
            <div class="specialNameRow">
              <span class="specialName">CAFE LAILA</span>
              <span class="specialRating">4.8</span>
            </div>
            <div class="specialDelivery">25–30 мин</div>
          </div>
        </div>
      </div>
    </div>
    <!-- Второй блок: Стоит попробовать -->
    <div class="specialSection">
      <div class="specialHeader">
        <span class="specialTitle">Стоит попробовать</span>
        <button class="specialButton">
          <span class="specialButtonText">Все</span>
          <img class="storesButtonArrow" src="icons/right-arrow 2.png" width="5" height="7">
        </button>
      </div>
      <div class="specialCards">
        <div class="specialCard restaurant-card" data-screen="restaurant-kubdari" data-id="kubdari" data-name="ДОМ КУБДАРИ" data-rating="4.9" data-delivery="25–30 мин" data-img="icons/кудбари.png">
          <div class="specialPreview" style="background-image:url(icons/кудбари.png)">
            <button class="specialFavorite">
              <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              </svg>
            </button>
          </div>
          <div class="specialInfo">
            <div class="specialNameRow">
              <span class="specialName">ДОМ КУБДАРИ</span>
              <span class="specialRating">4.9</span>
            </div>
            <div class="specialDelivery">25–30 мин</div>
          </div>
        </div>
        <div class="specialCard restaurant-card" data-screen="restaurant-ushba" data-id="ushba" data-name="CAFE USHBA" data-rating="4.6" data-delivery="25–30 мин" data-img="icons/ushba.png">
          <div class="specialPreview" style="background-image:url(icons/ushba.png)">
            <button class="specialFavorite">
              <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              </svg>
            </button>
          </div>
          <div class="specialInfo">
            <div class="specialNameRow">
              <span class="specialName">CAFE USHBA</span>
              <span class="specialRating">4.6</span>
            </div>
            <div class="specialDelivery">25–30 мин</div>
          </div>
        </div>
        <div class="specialCard restaurant-card" data-screen="restaurant-laila" data-id="laila" data-name="CAFE LAILA" data-rating="4.8" data-delivery="25–30 мин" data-img="icons/laila.png">
          <div class="specialPreview" style="background-image:url(icons/laila.png)">
            <button class="specialFavorite">
              <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              </svg>
            </button>
          </div>
          <div class="specialInfo">
            <div class="specialNameRow">
              <span class="specialName">CAFE LAILA</span>
              <span class="specialRating">4.8</span>
            </div>
            <div class="specialDelivery">25–30 мин</div>
          </div>
        </div>
        <div class="specialCard restaurant-card" data-screen="restaurant-bbq" data-id="bbq" data-name="BBQ GARDEN" data-rating="4.5" data-delivery="25–30 мин" data-img="icons/bbq.png">
          <div class="specialPreview" style="background-image:url(icons/bbq.png)">
            <button class="specialFavorite">
              <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              </svg>
            </button>
          </div>
          <div class="specialInfo">
            <div class="specialNameRow">
              <span class="specialName">BBQ GARDEN</span>
              <span class="specialRating">4.5</span>
            </div>
            <div class="specialDelivery">25–30 мин</div>
          </div>
        </div>
      </div>
    </div>
    <!-- Копия блока Категории блюд -->
    <section class="mg-categories">
      <div class="mg-categories__title">Категории блюд</div>
      <div class="mg-categories__list" onclick="goTab('categories')">
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Фастфуд</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Местная</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Грузинская</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Европа</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Восток</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Италия</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Япония</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Бургеры</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Пицца</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Шаурма</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Сэндвичи</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Выпечка</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Блины</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Десерты</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Шашлык</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Паста</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Супы</div>
        </div>
        <div class="mg-category-item">
          <div class="mg-category-item__icon"></div>
          <div class="mg-category-item__text">Паста</div>
        </div>
      </div>
      <div class="mg-categories__controls">
        <button class="mg-control-button mg-control-button--settings">
        </button>
        <button class="mg-control-button mg-control-button--rating">
          <span class="mg-control-button__text">Рейтинг</span>
        </button>
        <button class="mg-control-button mg-control-button--promos">
          <span class="mg-control-button__text">Акции</span>
        </button>
        <button class="mg-control-button mg-control-button--time">
          <span class="mg-control-button__text">До 30 мин</span>
        </button>
      </div>
    </section>
    <!-- Список всех ресторанов (без заголовка) -->
    <div class="allRestaurantsList">
      <div class="allRestaurantCard restaurant-card" data-screen="restaurant-bbq" data-id="bbq" data-name="BBQ GARDEN" data-rating="4.5" data-delivery="25–30 мин" data-img="icons/bbq.png">
        <div class="allRestaurantPreview" style="background-image:url(icons/bbq.png)">
          <button class="allRestaurantFavorite">
            <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
          </button>
        </div>
        <div class="allRestaurantInfo">
          <div class="allRestaurantNameRow">
            <span class="allRestaurantName">BBQ GARDEN</span>
            <span class="allRestaurantRating">4.5</span>
          </div>
          <div class="allRestaurantDelivery">25–30 мин</div>
        </div>
      </div>
      <div class="allRestaurantCard restaurant-card" data-screen="restaurant-sunset" data-id="sunset" data-name="SUNSET RESTAURANT" data-rating="4.7" data-delivery="25–30 мин" data-img="icons/sunset.png">
        <div class="allRestaurantPreview" style="background-image:url(icons/sunset.png)">
          <button class="allRestaurantFavorite">
            <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
          </button>
        </div>
        <div class="allRestaurantInfo">
          <div class="allRestaurantNameRow">
            <span class="allRestaurantName">SUNSET RESTAURANT</span>
            <span class="allRestaurantRating">4.7</span>
          </div>
          <div class="allRestaurantDelivery">25–30 мин</div>
        </div>
      </div>
      <div class="allRestaurantCard restaurant-card" data-screen="restaurant-kubdari" data-id="kubdari" data-name="ДОМ КУБДАРИ" data-rating="4.9" data-delivery="25–30 мин" data-img="icons/кудбари.png">
        <div class="allRestaurantPreview" style="background-image:url(icons/кудбари.png)">
          <button class="allRestaurantFavorite">
            <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
          </button>
        </div>
        <div class="allRestaurantInfo">
          <div class="allRestaurantNameRow">
            <span class="allRestaurantName">ДОМ КУБДАРИ</span>
            <span class="allRestaurantRating">4.9</span>
          </div>
          <div class="allRestaurantDelivery">25–30 мин</div>
        </div>
      </div>
      <div class="allRestaurantCard restaurant-card" data-screen="restaurant-ushba" data-id="ushba" data-name="CAFE USHBA" data-rating="4.6" data-delivery="25–30 мин" data-img="icons/ushba.png">
        <div class="allRestaurantPreview" style="background-image:url(icons/ushba.png)">
          <button class="allRestaurantFavorite">
            <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
          </button>
        </div>
        <div class="allRestaurantInfo">
          <div class="allRestaurantNameRow">
            <span class="allRestaurantName">CAFE USHBA</span>
            <span class="allRestaurantRating">4.6</span>
          </div>
          <div class="allRestaurantDelivery">25–30 мин</div>
        </div>
      </div>
      <div class="allRestaurantCard restaurant-card" data-screen="restaurant-laila" data-id="laila" data-name="CAFE LAILA" data-rating="4.8" data-delivery="25–30 мин" data-img="icons/laila.png">
        <div class="allRestaurantPreview" style="background-image:url(icons/laila.png)">
          <button class="allRestaurantFavorite">
            <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
          </button>
        </div>
        <div class="allRestaurantInfo">
          <div class="allRestaurantNameRow">
            <span class="allRestaurantName">CAFE LAILA</span>
            <span class="allRestaurantRating">4.8</span>
          </div>
          <div class="allRestaurantDelivery">25–30 мин</div>
        </div>
      </div>
    </div>
  </div>
  <!-- FAVORITES -->
  <div class="screen" data-screen="favorites">
    <div class="back-btn" onclick="goTab('home')">
      <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </div>
    <div class="fav-title">Избранное</div>
    <div class="searchRow">
      <div class="search-input">
        <svg class="search-icon" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="6" cy="6" r="5.3" stroke="#40CC5E" stroke-width="1.4"/>
          <path d="M9.8 9.8L13 13" stroke="#40CC5E" stroke-width="1.4" stroke-linecap="round"/>
        </svg>
        <span class="search-text">Искать в избранном</span>
      </div>
      <button class="find-button">Найти</button>
    </div>
    <div id="fav-empty" class="empty-wrap">
      <div class="image-placeholder"></div>
      <div class="empty-title">Нажимайте на сердечки,</div>
      <div class="empty-subtitle">чтобы сохранять любимые места</div>
      <button class="go-btn" onclick="goTab('home')">Перейти к ресторанам</button>
    </div>
    <div id="fav-list" class="allRestaurantsList" style="display:none"></div>
  </div>
  <!-- CATEGORIES (empty page) -->
  <div class="screen" data-screen="categories">
    <div class="back-btn" onclick="goTab('home')">
      <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </div>
    <div class="fav-title">Категории</div>
    <!-- Empty content -->
  </div>
  <!-- RESTAURANTS (all restaurants page) -->
  <div class="screen" data-screen="restaurants">
    <div class="back-btn" onclick="goTab('home')">
      <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </div>
    <div class="fav-title">Рестораны</div>
    <div class="allRestaurantsList">
      <div class="allRestaurantCard restaurant-card" data-screen="restaurant-bbq" data-id="bbq" data-name="BBQ GARDEN" data-rating="4.5" data-delivery="25–30 мин" data-img="icons/bbq.png">
        <div class="allRestaurantPreview" style="background-image:url(icons/bbq.png)">
          <button class="allRestaurantFavorite">
            <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
          </button>
        </div>
        <div class="allRestaurantInfo">
          <div class="allRestaurantNameRow">
            <span class="allRestaurantName">BBQ GARDEN</span>
            <span class="allRestaurantRating">4.5</span>
          </div>
          <div class="allRestaurantDelivery">25–30 мин</div>
        </div>
      </div>
      <div class="allRestaurantCard restaurant-card" data-screen="restaurant-sunset" data-id="sunset" data-name="SUNSET RESTAURANT" data-rating="4.7" data-delivery="25–30 мин" data-img="icons/sunset.png">
        <div class="allRestaurantPreview" style="background-image:url(icons/sunset.png)">
          <button class="allRestaurantFavorite">
            <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
          </button>
        </div>
        <div class="allRestaurantInfo">
          <div class="allRestaurantNameRow">
            <span class="allRestaurantName">SUNSET RESTAURANT</span>
            <span class="allRestaurantRating">4.7</span>
          </div>
          <div class="allRestaurantDelivery">25–30 мин</div>
        </div>
      </div>
      <div class="allRestaurantCard restaurant-card" data-screen="restaurant-kubdari" data-id="kubdari" data-name="ДОМ КУБДАРИ" data-rating="4.9" data-delivery="25–30 мин" data-img="icons/кудбари.png">
        <div class="allRestaurantPreview" style="background-image:url(icons/кудбари.png)">
          <button class="allRestaurantFavorite">
            <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
          </button>
        </div>
        <div class="allRestaurantInfo">
          <div class="allRestaurantNameRow">
            <span class="allRestaurantName">ДОМ КУБДАРИ</span>
            <span class="allRestaurantRating">4.9</span>
          </div>
          <div class="allRestaurantDelivery">25–30 мин</div>
        </div>
      </div>
      <div class="allRestaurantCard restaurant-card" data-screen="restaurant-ushba" data-id="ushba" data-name="CAFE USHBA" data-rating="4.6" data-delivery="25–30 мин" data-img="icons/ushba.png">
        <div class="allRestaurantPreview" style="background-image:url(icons/ushba.png)">
          <button class="allRestaurantFavorite">
            <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
          </button>
        </div>
        <div class="allRestaurantInfo">
          <div class="allRestaurantNameRow">
            <span class="allRestaurantName">CAFE USHBA</span>
            <span class="allRestaurantRating">4.6</span>
          </div>
          <div class="allRestaurantDelivery">25–30 мин</div>
        </div>
      </div>
      <div class="allRestaurantCard restaurant-card" data-screen="restaurant-laila" data-id="laila" data-name="CAFE LAILA" data-rating="4.8" data-delivery="25–30 мин" data-img="icons/laila.png">
        <div class="allRestaurantPreview" style="background-image:url(icons/laila.png)">
          <button class="allRestaurantFavorite">
            <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
          </button>
        </div>
        <div class="allRestaurantInfo">
          <div class="allRestaurantNameRow">
            <span class="allRestaurantName">CAFE LAILA</span>
            <span class="allRestaurantRating">4.8</span>
          </div>
          <div class="allRestaurantDelivery">25–30 мин</div>
        </div>
      </div>
    </div>
  </div>
  <!-- SHOPS (empty page) -->
  <div class="screen" data-screen="shops">
    <div class="back-btn" onclick="goTab('home')">
      <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </div>
    <div class="fav-title">Магазины</div>
    <!-- Empty content -->
  </div>
  <!-- PROMOS (empty page) -->
  <div class="screen" data-screen="promos">
    <div class="back-btn" onclick="goTab('home')">
      <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </div>
    <div class="fav-title">Акции</div>
    <!-- Empty content -->
  </div>
  <!-- Restaurant Pages -->
  <div class="screen" data-screen="restaurant-bbq">
    <div class="back-btn" onclick="goTab('home')">
      <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </div>
    <div class="fav-title">BBQ GARDEN</div>
    <!-- Empty content for restaurant -->
  </div>
  <div class="screen" data-screen="restaurant-sunset">
    <div class="back-btn" onclick="goTab('home')">
      <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </div>
    <div class="fav-title">SUNSET RESTAURANT</div>
    <!-- Empty content for restaurant -->
  </div>
  <div class="screen" data-screen="restaurant-kubdari">
    <div class="back-btn" onclick="goTab('home')">
      <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </div>
    <div class="fav-title">ДОМ КУБДАРИ</div>
    <!-- Empty content for restaurant -->
  </div>
  <div class="screen" data-screen="restaurant-ushba">
    <div class="back-btn" onclick="goTab('home')">
      <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </div>
    <div class="fav-title">CAFE USHBA</div>
    <!-- Empty content for restaurant -->
  </div>
  <div class="screen" data-screen="restaurant-laila">
    <div class="back-btn" onclick="goTab('home')">
      <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </div>
    <div class="fav-title">CAFE LAILA</div>
    <!-- Empty content for restaurant -->
  </div>
  <!-- PROFILE -->
  <div class="screen" data-screen="profile">
    <div class="header">
      <div class="avatar">AS</div>
      <div class="nickname">affiliate sxclipse</div>
      <div class="id">ID 9344544</div>
    </div>

    <div class="menu">
      <div class="item" onclick="goTab('favorites')">Избранное</div>
      <div class="item">Мой адрес</div>
      <div class="item">История заказов</div>
      <div class="item">Способы оплаты</div>
    </div>

    <div class="new-menu">
      <div class="new-item">Поддержка</div>
      <div class="new-item">Пригласить друга</div>
      <div class="new-item">Стать партнером</div>
    </div>

    <div class="service-menu">
      <div class="service-item">
        <div class="service-item__text">О сервисе</div>
      </div>
      <div class="service-item">
        <div class="service-item__text">Язык</div>
        <div class="service-item__subtext">Русский</div>
      </div>
    </div>

    <div class="add-home-block">
      <div class="add-home-inner-block">Добавить на главный экран</div>
      <div class="add-home-description">
        Добавьте значок сервиса на главный экран смартфона, чтобы он всегда был под рукой.
      </div>
    </div>
  </div>



</div>
      </div>
    </div>
  </div>
</div>
<!-- CART OVERLAY -->
<div class="cart-overlay" id="cart">
  <div class="cart-sheet">
    <div class="cart-close" onclick="toggleCart(false)">✕</div>
    <div class="cart-empty-img"></div>
    <div class="cart-empty-title">Похоже, тут ничего нет.</div>
    <div class="cart-empty-sub">У нас большой выбор ресторанов и магазинов, выбирайте и заказывайте из понравившихся.</div>
    <button class="cart-btn" onclick="goTab('home'); toggleCart(false)">Перейти к ресторанам</button>
  </div>
</div>
<!-- TABBAR -->
<div class="tabbar-wrapper">
  <nav class="tabbar">
    <button class="tab active" onclick="goTab('home', this)">
      <img src="icons/general-green.png" data-default="icons/general-gray.png" data-active="icons/general-green.png" class="tabicon"><span>Главная</span>
    </button>
    <button class="tab" onclick="goTab('favorites', this)">
      <img src="icons/heart-gray.png" data-default="icons/heart-gray.png" data-active="icons/heart-green.png" class="tabicon"><span>Избранное</span>
    </button>
    <button class="tab" onclick="toggleCart(true)">
      <img src="icons/basket-gray.png" class="tabicon"><span>Корзина</span>
    </button>
    <button class="tab" onclick="goTab('profile', this)">
      <img src="icons/profile-gray.png" data-default="icons/profile-gray.png" data-active="icons/profile-green.png" class="tabicon"><span>Профиль</span>
    </button>
  </nav>
</div>

<script>
/* ===== Platform detect (iOS) ===== */
const IS_IOS = (() => {
  const ua = navigator.userAgent || '';
  const iOS = /iPad|iPhone|iPod/.test(ua);
  const iPadOS = (navigator.platform === 'MacIntel' && (navigator.maxTouchPoints || 0) > 1);
  return iOS || iPadOS;
})();
if (IS_IOS) document.documentElement.classList.add('ios');

/* Telegram colors (helps убрать белые зоны на iOS) */
try{
  if (window.Telegram && Telegram.WebApp){
    Telegram.WebApp.setBackgroundColor('#0b0b0b');
    Telegram.WebApp.setHeaderColor('#0b0b0b');
  }
}catch(_){}

/* =========================
   RESPONSIVE SCALE (keeps 393px design, fits any phone width)
========================= */

/* =========================
   TELEGRAM / MOBILE VIEWPORT FIX
   (prevents "everything slides down" and ensures overlays cover full height)
========================= */
function getViewportWidth(){
  if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.viewportWidth === 'number' && Telegram.WebApp.viewportWidth > 0){
    return Telegram.WebApp.viewportWidth;
  }
  if (window.visualViewport && typeof visualViewport.width === 'number' && visualViewport.width > 0){
    return visualViewport.width;
  }
  return document.documentElement.clientWidth || window.innerWidth || 393;
}
function getViewportHeight(){
  // Telegram WebApp: stable height is most reliable (especially on desktop)
  if (window.Telegram && Telegram.WebApp){
    const hs = Telegram.WebApp.viewportStableHeight;
    if (typeof hs === 'number' && hs > 0) return hs;

    const h = Telegram.WebApp.viewportHeight;
    if (typeof h === 'number' && h > 0) return h;
  }
  if (window.visualViewport && typeof visualViewport.height === 'number' && visualViewport.height > 0){
    return visualViewport.height;
  }
  return window.innerHeight || document.documentElement.clientHeight || 700;
}
function updateViewportVars(){
  const h = getViewportHeight();
  document.documentElement.style.setProperty('--vh', (h * 0.01) + 'px');
}
function resetScroll(){
  const root = document.getElementById('scrollRoot');
  const se = document.scrollingElement || document.documentElement;

  const doReset = () => {
    try{
      if(root){
        if(root.scrollTo) root.scrollTo({top:0,left:0,behavior:'auto'});
        root.scrollTop = 0;
      }
      if(se) se.scrollTop = 0;
      if(document.body) document.body.scrollTop = 0;
      try{ window.scrollTo(0,0); }catch(e){}
    }catch(e){}
  };

  // Telegram Desktop/WebView sometimes applies scroll after layout — reset multiple times
  doReset();
  requestAnimationFrame(()=>{
    doReset();
    requestAnimationFrame(doReset);
  });
}
// hard scroll-lock for iOS/Telegram when overlays are open
let __lockY = 0;
function lockScroll(){
  const root = document.getElementById('scrollRoot');
  if(!root) return;
  __lockY = root.scrollTop || 0;
  root.style.overflow = 'hidden';
  root.style.touchAction = 'none';
}
function unlockScroll(){
  const root = document.getElementById('scrollRoot');
  if(!root) return;
  root.style.overflow = '';
  root.style.touchAction = '';
  root.scrollTop = __lockY;
}

function applyScale(){
  updateViewportVars();

  const designW = 393;
  const vw = getViewportWidth();
  const scaleRaw = vw / designW;
  const scale = Math.min(1, scaleRaw);

  document.documentElement.style.setProperty('--scale', String(scale));
  document.documentElement.style.setProperty('--inv-scale', String(scale ? (1/scale) : 1));

  // Stage takes the *visual* size so Telegram/Desktop scrolling is consistent
  const stage = document.getElementById('appStage');
  const app = document.getElementById('app');
  if(stage && app){
    const minH = getViewportHeight();
    const stageW = (designW * scale);
    const contentH = app.scrollHeight * scale;
    const stageH = Math.max(contentH, minH);

    stage.style.width = stageW + 'px';
    stage.style.height = stageH + 'px';

    document.documentElement.style.setProperty('--stage-w', stageW + 'px');
    document.documentElement.style.setProperty('--stage-h', stageH + 'px');
  }
}

/* =========================
   NAVIGATION
========================= */
function goTab(screenId, btn){
  const screen = document.querySelector('.screen[data-screen="'+screenId+'"]');
  if(!screen){
    console.warn('Screen not found:', screenId);
    return;
  }

  // show screen
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  screen.classList.add('active');

  // update tab state only for real tabs
  const tabMap = {
    home: document.querySelector('.tabbar .tab:nth-child(1)'),
    favorites: document.querySelector('.tabbar .tab:nth-child(2)'),
    profile: document.querySelector('.tabbar .tab:nth-child(4)'),
  };
  if(!btn && tabMap[screenId]) btn = tabMap[screenId];

  if(btn && tabMap[screenId]){
    document.querySelectorAll('.tabbar .tab').forEach(t=>{
      t.classList.remove('active');
      const i = t.querySelector('img');
      if(i && i.dataset.default) i.src = i.dataset.default;
    });
    btn.classList.add('active');
    const ai = btn.querySelector('img');
    if(ai && ai.dataset.active) ai.src = ai.dataset.active;
  }

  resetScroll();
  applyScale();

  // special: render favorites on enter
  if(screenId === 'favorites') renderFavorites();
  applyScale();
}

/* =========================
   CART OVERLAY
========================= */
function toggleCart(open){
  const cart = document.getElementById('cart');
  const isOpen = !!open;
  cart.classList.toggle('active', isOpen);
  document.documentElement.classList.toggle('cart-open', isOpen);

  if(isOpen){
    lockScroll();
  } else {
    unlockScroll();
  }
  applyScale();
}

/* =========================
   FAVORITES (localStorage)
========================= */
const FAV_KEY = 'favorites';

function getFav(){
  try{
    const v = JSON.parse(localStorage.getItem(FAV_KEY) || '[]');
    return Array.isArray(v) ? v : [];
  }catch(_){
    return [];
  }
}
function setFav(arr){
  localStorage.setItem(FAV_KEY, JSON.stringify(arr || []));
}

function syncHearts(){
  const favIds = new Set(getFav().map(x => x.id));
  document.querySelectorAll('.restaurant-card').forEach(card=>{
    const btn = card.querySelector('.specialFavorite, .allRestaurantFavorite');
    if(!btn) return;
    btn.classList.toggle('active', favIds.has(card.dataset.id));
  });
}

function renderFavorites(){
  const list = document.getElementById('fav-list');
  const empty = document.getElementById('fav-empty');
  if(!list || !empty) return;

  const fav = getFav();
  list.innerHTML = '';

  if(!fav.length){
    list.style.display = 'none';
    empty.style.display = 'block';
    return;
  }

  empty.style.display = 'none';
  list.style.display = 'flex';

  fav.forEach(it=>{
    const card = document.createElement('div');
    card.className = 'allRestaurantCard restaurant-card';
    card.dataset.screen = it.screen || ('restaurant-' + it.id);
    card.dataset.id = it.id;
    card.dataset.name = it.name;
    card.dataset.rating = it.rating;
    card.dataset.delivery = it.delivery;
    card.dataset.img = it.img;

    card.innerHTML = `
      <div class="allRestaurantPreview" style="background-image:url(${it.img})">
        <button class="allRestaurantFavorite" aria-label="Добавить в избранное">
          <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
          </svg>
        </button>
      </div>
      <div class="allRestaurantInfo">
        <div class="allRestaurantNameRow">
          <span class="allRestaurantName">${it.name}</span>
          <span class="allRestaurantRating">${it.rating}</span>
        </div>
        <div class="allRestaurantDelivery">${it.delivery}</div>
      </div>
    `;
    list.appendChild(card);
  });

  syncHearts();
  applyScale();
}

function toggleFavByCard(card){
  const id = card?.dataset?.id;
  if(!id) return;

  const fav = getFav();
  const idx = fav.findIndex(x => x.id === id);

  if(idx > -1){
    fav.splice(idx, 1);
    setFav(fav);
    syncHearts();
    renderFavorites();
    return;
  }

  fav.push({
    id,
    screen: card.dataset.screen || ('restaurant-' + id),
    name: card.dataset.name || '',
    rating: card.dataset.rating || '',
    delivery: card.dataset.delivery || '',
    img: card.dataset.img || ''
  });
  setFav(fav);
  syncHearts();
  renderFavorites();
}

/* =========================
   CLICK HANDLERS
========================= */
document.addEventListener('click', (e)=>{
  const favBtn = e.target.closest('.specialFavorite, .allRestaurantFavorite');
  if(favBtn){
    e.preventDefault();
    e.stopPropagation();

    // animate only this heart
    favBtn.classList.remove('animate');
    void favBtn.offsetWidth;
    favBtn.classList.add('animate');

    const card = favBtn.closest('.restaurant-card');
    if(card) toggleFavByCard(card);
    return;
  }

  const card = e.target.closest('.restaurant-card');
  if(card && card.dataset.screen){
    goTab(card.dataset.screen);
  }
});

/* =========================
   TABBAR HIDE ON SCROLL
========================= */
function initTabbarHideOnScroll(){
  const bar = document.querySelector('.tabbar');
  const root = document.getElementById('scrollRoot');
  if(!bar || !root) return;
  if (document.documentElement.classList.contains('ios')) return;

  let lastY = root.scrollTop || 0;
  let ticking = false;

  function onScroll(){
    const y = root.scrollTop || 0;
    const delta = y - lastY;
    if(Math.abs(delta) < 8) return;

    if(delta > 0){
      // down
      bar.style.transform = 'translateY(100%)';
    }else{
      // up
      bar.style.transform = 'translateY(0)';
    }
    lastY = y;
  }

  root.addEventListener('scroll', ()=>{
    if(!ticking){
      window.requestAnimationFrame(()=>{
        onScroll();
        ticking = false;
      });
      ticking = true;
    }
  }, {passive:true});
}

/* =========================
   INIT
========================= */
document.addEventListener('DOMContentLoaded', ()=>{
  syncHearts();
  renderFavorites();
  initTabbarHideOnScroll();
  applyScale();

  const onViewportChange = ()=>{ applyScale(); };

  window.addEventListener('resize', onViewportChange, {passive:true});
  if (window.visualViewport){
    try{
      visualViewport.addEventListener('resize', onViewportChange, {passive:true});
      visualViewport.addEventListener('scroll', onViewportChange, {passive:true});
    }catch(e){}
  }

  // Telegram MiniApp support
  if (window.Telegram && Telegram.WebApp) {
    try { Telegram.WebApp.ready && Telegram.WebApp.ready(); } catch(e){}
    try { Telegram.WebApp.expand(); } catch(e){}
    if (Telegram.WebApp.onEvent) {
      Telegram.WebApp.onEvent('viewportChanged', onViewportChange);
      Telegram.WebApp.onEvent('themeChanged', onViewportChange);
    }
  }
});
</script>

</body>
</html>
